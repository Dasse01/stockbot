<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI ì£¼ì‹ ì• ë„ë¦¬ìŠ¤íŠ¸</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .typing {
      white-space: pre-wrap;
      font-family: 'Courier New', monospace;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center py-10 px-4 sm:px-6">
  <div class="max-w-2xl w-full">
    <h1 class="text-2xl sm:text-3xl font-bold text-center mb-6">ğŸ“Š AI ì£¼ì‹ ì• ë„ë¦¬ìŠ¤íŠ¸ (ì‹¤ì‹œê°„ GPT-4 ë¶„ì„)</h1>

    <label for="stockInput" class="block text-lg mb-1 text-center">ë¶„ì„í•  ì¢…ëª©ëª…ì„ ì…ë ¥í•˜ì„¸ìš”</label>
    <input id="stockInput" class="w-full p-3 text-base border border-gray-300 rounded-lg mb-4" placeholder="ì˜ˆ: ì¹´ì¹´ì˜¤, ì‚¼ì„±ì „ì, í…ŒìŠ¬ë¼ ë“±" />

    <div class="grid grid-cols-2 gap-2 sm:flex sm:flex-wrap mb-6">
      <button onclick="fetchGPTResult('fundamental')" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-md text-base">â‘  ê¸°ë³¸ì  ë¶„ì„</button>
      <button onclick="fetchGPTResult('technical')" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-md text-base">â‘¡ ê¸°ìˆ ì  ë¶„ì„</button>
      <button onclick="fetchGPTResult('industry')" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-md text-base">â‘¢ ì‚°ì—…/ì‹œì¥ ë¶„ì„</button>
      <button onclick="fetchGPTResult('news')" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-md text-base">â‘£ ë‰´ìŠ¤/ì´ìŠˆ ë¶„ì„</button>
      <button onclick="fetchGPTResult('conclusion')" class="w-full col-span-2 bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-md text-base">â–¶ ì¢…í•© íŒë‹¨</button>
      <button onclick="fetchGPTResult('buy')" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-3 px-4 rounded-md text-base">ğŸ“ˆ ë§¤ìˆ˜ íŒë‹¨</button>
      <button onclick="fetchGPTResult('sell')" class="w-full bg-red-500 hover:bg-red-600 text-white py-3 px-4 rounded-md text-base">ğŸ“‰ ë§¤ë„ íŒë‹¨</button>
    </div>

    <div id="output" class="bg-white p-5 rounded-lg shadow text-gray-800 typing min-h-[200px] text-sm sm:text-base">
      ğŸ”„ GPTê°€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤...
    </div>
  </div>

  <script>
    async function fetchGPTResult(type) {
      const stock = document.getElementById("stockInput").value.trim() || "ì‚¼ì„±ì „ì";
      const resultBox = document.getElementById("output");
      resultBox.innerText = "âŒ¨ï¸ GPT-4ê°€ ì‹¤ì‹œê°„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...\\n\\n";

      const typeMap = {
        fundamental: "â‘  ê¸°ë³¸ì  ë¶„ì„ (PER, PBR, ì¬ë¬´ ê±´ì „ì„±, ì‹¤ì  ë“±)",
        technical: "â‘¡ ê¸°ìˆ ì  ë¶„ì„ (ì°¨íŠ¸ íë¦„, ì§€ì§€/ì €í•­, RSI ë“±)",
        industry: "â‘¢ ì‚°ì—… ë° ì‹œì¥ ë¶„ì„ (ì‚°ì—… íŠ¸ë Œë“œ, ê²½ìŸì‚¬ ë“±)",
        news: "â‘£ ë‰´ìŠ¤ ë° ì´ìŠˆ ë¶„ì„ (ìµœê·¼ ì´ë²¤íŠ¸, ê³µì‹œ ë“±)",
        conclusion: "â–¶ ì¢…í•© íŒë‹¨ (ë§¤ìˆ˜ / ë³´ìœ  / ë§¤ë„ ë“±)",
        buy: "ğŸ“ˆ ì§€ê¸ˆ ì´ ì¢…ëª©ì„ ë§¤ìˆ˜í•´ë„ ë˜ëŠ”ì§€ íˆ¬ì ê´€ì ì—ì„œ ë¶„ì„í•´ì¤˜",
        sell: "ğŸ“‰ ì§€ê¸ˆ ì´ ì¢…ëª©ì„ ë§¤ë„í•´ë„ ë˜ëŠ”ì§€ íˆ¬ì ê´€ì ì—ì„œ ë¶„ì„í•´ì¤˜"
      };

      const prompt = `"${stock}" ì¢…ëª©ì— ëŒ€í•´ ${typeMap[type]} ê°„ê²°í•˜ê³  ëª…í™•í•˜ê²Œ ì•Œë ¤ì¤˜.`;

      const response = await fetch("/.netlify/functions/gpt", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt })
      });

      const reader = response.body.getReader();
      const decoder = new TextDecoder("utf-8");
      let resultText = "";

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;

        const chunk = decoder.decode(value);
        const lines = chunk.split("\n").filter(line => line.trim().startsWith("data:"));

        for (const line of lines) {
          const data = line.replace("data: ", "").trim();
          if (data === "[DONE]") break;

          const parsed = JSON.parse(data);
          const content = parsed.choices?.[0]?.delta?.content;
          if (content) {
            resultText += content;
            resultBox.innerText = resultText;
          }
        }
      }
    }
  </script>
</body>
</html>
